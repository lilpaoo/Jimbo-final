<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Jimbo - AI Personal Trainer</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="style.css">
  
  <script src="script.js" defer></script>

  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://apis.google.com/js/api.js" async defer onload="gapiLoaded()"></script>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  
</head>
<body>

  <!-- THAY TOÀN BỘ div#auth-container BẰNG CÁI NÀY -->
  <div id="auth-container">
    <!-- Landing page đẹp như FitPlan -->
    <div id="landing-page">
      <img class="landing-image" src="images/landing-bg.jpg" alt="Jimbo Image">
      <div class="landing-content">
        <h1>Jimbo</h1>
        <p>Achieve your fitness goals with personalized workout plans and progress tracking.</p>
        <button id="start-btn" class="start-button">Start</button>
      </div>
    </div>

    <!-- Modal login (ẩn lúc đầu) -->
    <div id="login-modal" class="modal hidden">
      <div class="modal-content">
        <button class="modal-close">&times;</button>
        <div class="auth-box-new">
          <h2 style="color: #2dd4bf">Welcome to Jimbo</h2>
          <p style="margin-top: 0.8rem; margin-bottom: 1.5rem; color: rgba(0, 0, 0, 0.9); font-size: 0.95rem;">
            Your AI-powered personal trainer. Sign in to get started.
          </p>

          <div class="auth-social">
            <button id="google-login-btn" class="btn google-btn">
              <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" viewBox="0 0 48 48"><g><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path><path fill="#FBBC05" d="M10.53 28.59c-.49-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24s.92 7.54 2.56 10.78l7.97-6.19z"></path><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.82l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path><path fill="none" d="M0 0h48v48H0z"></path></g></svg>
              <span>Sign in with Google</span>
            </button>
            
            <div class="auth-or"><span>OR</span></div>
            
            <button id="tester-login-btn" class="btn-secondary">Login as Tester</button>
          </div>

          <p id="auth-error"></p>
        </div>
      </div>
    </div>
  </div>

  <div id="main-app-container" class="hidden">
    <aside class="sidebar">
      <div class="logo">
        <img src="images/logo.png" alt="Jimbo">
      </div>
      <button id="sidebar-toggle" class="sidebar-toggle">☰</button>

      <nav>
        <div class="nav-item" data-tab="workout">
          <svg fill="currentColor" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4Zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10Z"/></svg>
          <span class="nav-text">Workout Generator</span>
        </div>
        <div class="nav-item" data-tab="nutrition">
          <svg version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <style type="text/css">  .st0{fill:#000000;}  </style> <g> <path class="st0" d="M215.078,8.156c-9.297,0-16.828,7.531-16.828,16.844v84.188h-27.203V23.328 C171.047,10.438,160.609,0,147.734,0c-12.891,0-23.328,10.438-23.328,23.328v85.859H97.219V25c0-9.313-7.547-16.844-16.844-16.844 S63.531,15.688,63.531,25v107.5h0.313c2.563,19.625,22.344,38.313,51.484,46.375v294.281c0,17.875,14.516,32.375,32.406,32.375 c17.875,0,32.359-14.5,32.359-32.375V178.094c25.313-7.219,48.906-22.516,51.547-45.594h0.266V25 C231.906,15.688,224.375,8.156,215.078,8.156z"></path> <path class="st0" d="M363.266,16.031c-18.797-6.375-47.188-10.188-47.188,18.656c0,0,0,419.594,0,443.375 c0,23.75,13.578,33.938,30.547,33.938s30.531-10.188,30.531-30.563c0-20.344,0-185.281,0-185.281s35.656,0,50.938,0 s20.375-18.688,20.375-32.281c0,0,0-50.969,0-93.406C448.469,78.281,403.031,29.563,363.266,16.031z"></path> </g> </g></svg>
          <span class="nav-text">Nutrition Generator</span>
        </div>
        <div class="nav-item" data-tab="progress">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125z"/>
          </svg>
          <span class="nav-text">Progress Logger</span>
        </div>
        <div class="nav-item" data-tab="form-analysis">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5l4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25z"/>
          </svg>
          <span class="nav-text">Form Analysis</span>
        </div>
        <div class="nav-item" data-tab="coach">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 0 1-2.555-.337A5.972 5.972 0 0 1 5.41 20.97a5.969 5.969 0 0 1-.474-.065 4.48 4.48 0 0 0 .978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25Z"/>
          </svg>
          <span class="nav-text">Coach Evaluation</span>
        </div>
      </nav>
      <div class="user-profile">
        <div class="user-avatar">U</div>
        <div>
          <div id="user-email-sidebar" style="font-weight: 600; color: #2dd4bf;">User</div>
          <div style="font-size: 0.8rem; color: var(--text-light);">Member</div>
        </div>
      </div>
    </aside>

    <main class="main">
      <header class="header">
        <div>
          <h1 class="title" id="page-title">Workout Generator</h1>
          <p class="subtitle" id="page-subtitle">Your data is saved securely.</p>
        </div>
        <div class="user-info">
          <span id="user-email">user@example.com</span>
          <button class="logout" id="sign-out-btn">Log out</button>
        </div>
      </header>

      <section id="workout" class="tab-content active">
        <div class="content">
          <div class="card">
            <h3 class="card-title">Your Details</h3>
            <form id="workout-form">
              <div class="form-group">
                <label class="form-label">Goal</label>
                <select id="goal" class="form-select" required>
                  <option value="">Select...</option>
                  <option value="Fat Loss">Fat Loss</option>
                  <option value="Muscle Gain" selected>Muscle Gain</option>
                  <option value="Strength">Strength</option>
                  <option value="Endurance">Endurance</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Experience Level</label>
                <select id="experience_level" class="form-select" required>
                  <option value="">Select...</option>
                  <option value="Beginner">Beginner</option>
                  <option value="Intermediate" selected>Intermediate</option>
                  <option value="Advanced">Advanced</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Days Per Week</label>
                <input type="number" id="days_per_week" class="form-input" min="1" max="7" value="4" required>
              </div>
              <div class="form-group">
                <label class="form-label">Hours Per Day</label>
                <input type="number" id="hours_per_day" class="form-input" step="0.5" min="0.5" max="3" value="1" required>
              </div>
              <div class="form-group">
                <label class="form-label">Available Equipment</label>
                <input type="text" id="available_equipment" class="form-input" placeholder="e.g., dumbbells, bench, pull-up bar" value="Full gym" required>
              </div>
              <button type="submit" class="btn" id="workout-generate-btn">Generate Plan</button>
            </form>
          </div>
          <div class="card">
            <h3 class="card-title">Your Workout Plan</h3>
            <div id="api-response" class="plan-output">Fill in your details and click Generate.</div>
            <button id="save-btn" class="btn" disabled style="margin-top: 1rem;">Save Plan</button>
            <p id="save-status" class="status"></p>
            
            <div id="workout-chat-widget" class="chat-widget hidden">
              <h4 class="chat-title">Chat with Jimbo about this plan:</h4>
              <div id="workout-chat-history" class="chat-history"></div>
              <div class="chat-input-area">
                <input type="text" id="workout-chat-input" class="chat-input" placeholder="Ask a question...">
                <button id="workout-chat-send" class="chat-send-btn">Send</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="nutrition" class="tab-content">
        <div class="content">
          <div class="card">
            <h3 class="card-title">Nutrition Details</h3>
            <form id="nutrition-form">
              <div class="form-group">
                <label class="form-label">Goal</label>
                <select id="nutri-goal" class="form-select" required>
                  <option value="">Select...</option>
                  <option value="Fat Loss" selected>Fat Loss</option>
                  <option value="Muscle Gain">Muscle Gain</option>
                  <option value="Maintenance">Maintenance</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Weight (kg)</label>
                <input type="number" id="nutri-weight" class="form-input" step="0.1" value="85" required>
              </div>
              <div class="form-group">
                <label class="form-label">Height (cm)</label>
                <input type="number" id="nutri-height" class="form-input" value="175" required>
              </div>
              <div class="form-group">
                <label class="form-label">Age</label>
                <input type="number" id="nutri-age" class="form-input" value="30" required>
              </div>
              <div class="form-group">
                <label class="form-label">Activity Level</label>
                <select id="nutri-activity" class="form-select" required>
                  <option value="">Select...</option>
                  <option value="Sedentary">Sedentary</option>
                  <option value="Lightly Active">Lightly Active</option>
                  <option value="Moderately Active" selected>Moderately Active</option>
                  <option value="Very Active">Very Active</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Dietary Preferences (optional)</label>
                <input type="text" id="nutri-prefs" class="form-input" placeholder="e.g., vegetarian, no dairy">
              </div>
              <button type="submit" class="btn" id="nutrition-generate-btn">Generate Nutrition Plan</button>
            </form>
          </div>
          <div class="card">
            <h3 class="card-title">Your Nutrition Plan</h3>
            <div id="nutrition-response" class="plan-output">Fill in your details and generate.</div>
            
            <button id="save-nutrition-btn" class="btn" disabled style="margin-top: 1rem;">Save Nutrition Plan</button>
            <p id="save-nutrition-status" class="status"></p>

            <div id="nutrition-chat-widget" class="chat-widget hidden">
              <h4 class="chat-title">Chat with Jimbo about this plan:</h4>
              <div id="nutrition-chat-history" class="chat-history"></div>
              <div class="chat-input-area">
                <input type="text" id="nutrition-chat-input" class="chat-input" placeholder="Ask a question...">
                <button id="nutrition-chat-send" class="chat-send-btn">Send</button>
              </div>
            </div>
          </div>
        </div>
      </section>
      
      <section id="progress" class="tab-content">
        <div class="content">
          <div class="card">
            <h3 class="card-title">Log Check-In</h3>
            <form id="checkin-form">
              <div class="form-group">
                <label class="form-label">Date</label>
                <input type="date" id="checkin-date" class="form-input" required>
              </div>
              <div class="form-group">
                <label class="form-label">Weight (kg)</label>
                <input type="number" id="checkin-weight" class="form-input" step="0.1" placeholder="e.g., 85.5">
              </div>
              <div class="form-group">
                <label class="form-label">Notes</label>
                <textarea id="checkin-notes" class="form-textarea" placeholder="e.g., Completed Day 1, felt strong." required></textarea>
              </div>
              <button type="submit" class="btn">Log Check-In</button>
            </form>
            
            <div id="tester-upload-section" class="hidden" style="margin-top: 2rem; border-top: 1px solid var(--input-border); padding-top: 2rem;">
                 <h4 class="card-title" style="margin-bottom: 1rem;">Load Tester Data</h4>
                 <p style="color: var(--text-light); font-size: 0.9rem; margin-bottom: 1rem;">Upload your `Jimbo_Data.xlsx` file to restore your saved plan and check-ins.</p>
                 <label class="file-input-wrapper" for="upload-data-file">
                    <span id="upload-file-name">Choose .xlsx file...</span>
                    <input type="file" id="upload-data-file" accept=".xlsx" required>
                </label>
                <p id="upload-status" class="status"></p>
            </div>
            
          </div>
          <div class="card">
            <h3 class="card-title">Recent Check-Ins</h3>
            <ul id="checkin-list" class="checkin-list" style="max-height: 400px; overflow-y: auto;">
              <li class="checkin-item">No check-ins yet.</li>
            </ul>
          </div>
        </div>
      </section>

      <section id="form-analysis" class="tab-content">
        <div class="content">
          <div class="card">
            <h3 class="card-title">Analyze Your Form</h3>
            <form id="form-analysis-form">
              <div class="form-group">
                <label class="form-label" for="exercise-select">Exercise</label>
                <select id="exercise-select" class="form-select" required>
                  <option value="">Loading exercises...</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label" for="video-upload">Upload Video</label>
                <label class="file-input-wrapper" for="video-upload-real">
                    <span id="file-name-display">Choose a video file...</span>
                    <input type="file" id="video-upload-real" accept="video/mp4,video/mov,video/avi" required>
                </label>
              </div>
              <button type.submit" class="btn" id="analyze-form-btn">Analyze Form</button>
            </form>
          </div>
          <div class="card">
            <h3 class="card-title">Form Analysis Report</h3>
            
            <div id="analysis-progress-container" class="hidden" style="margin-bottom: 1.5rem;">
                <div id="analysis-progress-status" style="font-weight: 500; margin-bottom: 0.5rem; color: var(--text-light);">Uploading...</div>
                <div class="progress-bar-outer">
                    <div id="analysis-progress-bar" class="progress-bar-inner" style="width: 0%;"></div>
                </div>
            </div>

            <div id="form-analysis-response" class="plan-output">
              <p>Please select an exercise and upload a video to get your form analysis.</p>
            </div>
          </div>
        </div>
      </section>

      <section id="coach" class="tab-content">
        <div class="content" style="grid-template-columns: 1fr; max-width: 800px; margin: 4rem auto 0;">
          <div class="card" style="text-align:center;">
            <h3 class="card-title">Get Your AI Evaluation</h3>
            <p style="margin: 1rem 0; color: var(--text-light);">
              Click the button to send your saved plan and check-ins to the AI Coach for a progress review.
            </p>
            <button id="evaluate-btn" class="btn" style="max-width: 300px; margin: 1rem auto;">Evaluate Progress</button>
            <h3 class="card-title" style="margin-top: 2rem;">Coach's Report</h3>
            <div id="eval-response" class="plan-output">Evaluation will appear here...</div>
          </div>
        </div>
      </section>
    </main>
  </div>

</body>
</html>