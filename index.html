<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Jimbo - AI Personal Trainer</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="style.css">
  
  <script src="script.js" defer></script>

  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://apis.google.com/js/api.js" async defer onload="gapiLoaded()"></script>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  
</head>
<body>

  <!-- THAY TOÀN BỘ div#auth-container BẰNG CÁI NÀY -->
  <div id="auth-container">
    <!-- Landing page đẹp như FitPlan -->
    <div id="landing-page">
      <img class="landing-image" src="images/landing-bg.jpg" alt="Jimbo Image">
      <div class="landing-content">
        <h1>Jimbo</h1>
        <p>Achieve your fitness goals with personalized workout plans and progress tracking.</p>
        <button id="start-btn" class="start-button">Start</button>
      </div>
    </div>

    <!-- Modal login (ẩn lúc đầu) -->
    <div id="login-modal" class="modal hidden">
      <div class="modal-content">
        <button class="modal-close">&times;</button>
        <div class="auth-box-new">
          <h2 style="color: #2dd4bf">Welcome to Jimbo</h2>
          <p style="margin-top: 0.8rem; margin-bottom: 1.5rem; color: rgba(0, 0, 0, 0.9); font-size: 0.95rem;">
            Your AI-powered personal trainer. Sign in to get started.
          </p>

          <div class="auth-social">
            <button id="google-login-btn" class="btn google-btn">
              <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" viewBox="0 0 48 48"><g><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path><path fill="#FBBC05" d="M10.53 28.59c-.49-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24s.92 7.54 2.56 10.78l7.97-6.19z"></path><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.82l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path><path fill="none" d="M0 0h48v48H0z"></path></g></svg>
              <span>Sign in with Google</span>
            </button>
            
            <div class="auth-or"><span>OR</span></div>
            
            <button id="tester-login-btn" class="btn-secondary">Login as Tester</button>
          </div>

          <p id="auth-error"></p>
        </div>
      </div>
    </div>
  </div>

  <div id="main-app-container" class="hidden">
    <aside class="sidebar">
      <div class="logo">
        <img src="images/logo.png" alt="Jimbo">
      </div>
      <button id="sidebar-toggle" class="sidebar-toggle">☰</button>

      <nav>
        <div class="nav-item" data-tab="workout">
          <svg fill="currentColor" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4Zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10Z"/></svg>
          <span class="nav-text">Workout Generator</span>
        </div>
        <div class="nav-item" data-tab="nutrition">
          <svg fill="currentColor" width="800px" height="800px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" d="M17,2 C17.5522847,2 18,2.44771525 18,3 C18,3.55228475 17.5522847,4 17,4 C14.6060126,4 13.3695615,4.90326036 13.0717604,6.92866732 C13.4229999,6.87683888 13.7457832,6.79126255 14.1108662,6.6654815 L14.3937153,6.56350644 L14.7196993,6.44090113 C15.5463139,6.13352796 16.1448777,6 17,6 C20.0545577,6 22,7.94663043 22,12 C22,17.2162914 20.1608115,22 17,22 C15.8880055,22 15.1044467,21.8599764 14.1748169,21.550663 L13.8588793,21.4412484 L13.565018,21.3349077 L13.1430741,21.189038 C12.8059545,21.0819563 12.5332036,21.025221 12.2323522,21.0068101 L12,21 C11.5991488,21 11.2783255,21.0551859 10.8569259,21.189038 L10.434982,21.3349077 L10.1411207,21.4412484 C9.06562275,21.8271314 8.23554948,22 7,22 C3.83918846,22 2,17.2162914 2,12 C2,7.94663043 3.9454423,6 7,6 C7.8551223,6 8.45368607,6.13352796 9.28030074,6.44090113 L9.60628474,6.56350644 C10.1418441,6.76405507 10.5646584,6.8860076 11.0553037,6.94825409 C11.4150382,3.73397931 13.4812343,2 17,2 Z M17,8 C16.4891945,8 16.1363674,8.06446503 15.6394344,8.23553224 L15.4167595,8.31549628 L15.0950848,8.43649356 C14.139796,8.79421651 13.3984816,8.9672419 12.3306767,8.99574467 L12,9 C10.7476416,9 9.9557329,8.8299888 8.90491521,8.43649356 L8.58324046,8.31549628 C7.96121631,8.08419923 7.5837777,8 7,8 C5.05028524,8 4,9.05092667 4,12 C4,16.1876638 5.46572574,20 7,20 C7.87053805,20 8.4503572,19.8993925 9.18294373,19.6565613 L9.97723383,19.3745877 C10.7085778,19.1190199 11.2769978,19 12,19 L12.3013195,19.007338 C12.7908307,19.0318833 13.2246152,19.1184306 13.7183823,19.2733676 L14.0227662,19.3745877 L14.8170563,19.6565613 C15.5496428,19.8993925 16.1294619,20 17,20 C18.5342743,20 20,16.1876638 20,12 C20,9.05092667 18.9497148,8 17,8 Z"/>
          </svg>
          <span class="nav-text">Nutrition Generator</span>
        </div>
        <div class="nav-item" data-tab="progress">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125z"/>
          </svg>
          <span class="nav-text">Progress Logger</span>
        </div>
        <div class="nav-item" data-tab="form-analysis">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5l4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25z"/>
          </svg>
          <span class="nav-text">Form Analysis</span>
        </div>
        <div class="nav-item" data-tab="coach">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 0 1-2.555-.337A5.972 5.972 0 0 1 5.41 20.97a5.969 5.969 0 0 1-.474-.065 4.48 4.48 0 0 0 .978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25Z"/>
          </svg>
          <span class="nav-text">Coach Evaluation</span>
        </div>
      </nav>
      <div class="user-profile">
        <div class="user-avatar">U</div>
        <div>
          <div id="user-email-sidebar" style="font-weight: 600; color: #2dd4bf;">User</div>
          <div style="font-size: 0.8rem; color: var(--text-light);">Member</div>
        </div>
      </div>
    </aside>

    <main class="main">
      <header class="header">
        <div>
          <h1 class="title" id="page-title">Workout Generator</h1>
          <p class="subtitle" id="page-subtitle">Your data is saved securely.</p>
        </div>
        <div class="user-info">
          <span id="user-email">user@example.com</span>
          <button class="logout" id="sign-out-btn">Log out</button>
        </div>
      </header>

      <section id="workout" class="tab-content active">
        <div class="content">
          <div class="card">
            <h3 class="card-title">Your Details</h3>
            <form id="workout-form">
              <div class="form-group">
                <label class="form-label">Goal</label>
                <select id="goal" class="form-select" required>
                  <option value="">Select...</option>
                  <option value="Fat Loss">Fat Loss</option>
                  <option value="Muscle Gain" selected>Muscle Gain</option>
                  <option value="Strength">Strength</option>
                  <option value="Endurance">Endurance</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Experience Level</label>
                <select id="experience_level" class="form-select" required>
                  <option value="">Select...</option>
                  <option value="Beginner">Beginner</option>
                  <option value="Intermediate" selected>Intermediate</option>
                  <option value="Advanced">Advanced</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Days Per Week</label>
                <input type="number" id="days_per_week" class="form-input" min="1" max="7" value="4" required>
              </div>
              <div class="form-group">
                <label class="form-label">Hours Per Day</label>
                <input type="number" id="hours_per_day" class="form-input" step="0.5" min="0.5" max="3" value="1" required>
              </div>
              <div class="form-group">
                <label class="form-label">Available Equipment</label>
                <input type="text" id="available_equipment" class="form-input" placeholder="e.g., dumbbells, bench, pull-up bar" value="Full gym" required>
              </div>
              <button type="submit" class="btn" id="workout-generate-btn">Generate Plan</button>
            </form>
          </div>
          <div class="card">
            <h3 class="card-title">Your Workout Plan</h3>
            <div id="api-response" class="plan-output">Fill in your details and click Generate.</div>
            <button id="save-btn" class="btn" disabled style="margin-top: 1rem;">Save Plan</button>
            <p id="save-status" class="status"></p>
            
            <div id="workout-chat-widget" class="chat-widget hidden">
              <h4 class="chat-title">Chat with Jimbo about this plan:</h4>
              <div id="workout-chat-history" class="chat-history"></div>
              <div class="chat-input-area">
                <input type="text" id="workout-chat-input" class="chat-input" placeholder="Ask a question...">
                <button id="workout-chat-send" class="chat-send-btn">Send</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="nutrition" class="tab-content">
        <div class="content">
          <div class="card">
            <h3 class="card-title">Nutrition Details</h3>
            <form id="nutrition-form">
              <div class="form-group">
                <label class="form-label">Goal</label>
                <select id="nutri-goal" class="form-select" required>
                  <option value="">Select...</option>
                  <option value="Fat Loss" selected>Fat Loss</option>
                  <option value="Muscle Gain">Muscle Gain</option>
                  <option value="Maintenance">Maintenance</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Weight (kg)</label>
                <input type="number" id="nutri-weight" class="form-input" step="0.1" value="85" required>
              </div>
              <div class="form-group">
                <label class="form-label">Height (cm)</label>
                <input type="number" id="nutri-height" class="form-input" value="175" required>
              </div>
              <div class="form-group">
                <label class="form-label">Age</label>
                <input type="number" id="nutri-age" class="form-input" value="30" required>
              </div>
              <div class="form-group">
                <label class="form-label">Activity Level</label>
                <select id="nutri-activity" class="form-select" required>
                  <option value="">Select...</option>
                  <option value="Sedentary">Sedentary</option>
                  <option value="Lightly Active">Lightly Active</option>
                  <option value="Moderately Active" selected>Moderately Active</option>
                  <option value="Very Active">Very Active</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Dietary Preferences (optional)</label>
                <input type="text" id="nutri-prefs" class="form-input" placeholder="e.g., vegetarian, no dairy">
              </div>
              <button type="submit" class="btn" id="nutrition-generate-btn">Generate Nutrition Plan</button>
            </form>
          </div>
          <div class="card">
            <h3 class="card-title">Your Nutrition Plan</h3>
            <div id="nutrition-response" class="plan-output">Fill in your details and generate.</div>
            
            <button id="save-nutrition-btn" class="btn" disabled style="margin-top: 1rem;">Save Nutrition Plan</button>
            <p id="save-nutrition-status" class="status"></p>

            <div id="nutrition-chat-widget" class="chat-widget hidden">
              <h4 class="chat-title">Chat with Jimbo about this plan:</h4>
              <div id="nutrition-chat-history" class="chat-history"></div>
              <div class="chat-input-area">
                <input type="text" id="nutrition-chat-input" class="chat-input" placeholder="Ask a question...">
                <button id="nutrition-chat-send" class="chat-send-btn">Send</button>
              </div>
            </div>
          </div>
        </div>
      </section>
      
      <section id="progress" class="tab-content">
        <div class="content">
          <div class="card">
            <h3 class="card-title">Log Check-In</h3>
            <form id="checkin-form">
              <div class="form-group">
                <label class="form-label">Date</label>
                <input type="date" id="checkin-date" class="form-input" required>
              </div>
              <div class="form-group">
                <label class="form-label">Weight (kg)</label>
                <input type="number" id="checkin-weight" class="form-input" step="0.1" placeholder="e.g., 85.5">
              </div>
              <div class="form-group">
                <label class="form-label">Notes</label>
                <textarea id="checkin-notes" class="form-textarea" placeholder="e.g., Completed Day 1, felt strong." required></textarea>
              </div>
              <button type="submit" class="btn">Log Check-In</button>
            </form>
            
            <div id="tester-upload-section" class="hidden" style="margin-top: 2rem; border-top: 1px solid var(--input-border); padding-top: 2rem;">
                 <h4 class="card-title" style="margin-bottom: 1rem;">Load Tester Data</h4>
                 <p style="color: var(--text-light); font-size: 0.9rem; margin-bottom: 1rem;">Upload your `Jimbo_Data.xlsx` file to restore your saved plan and check-ins.</p>
                 <label class="file-input-wrapper" for="upload-data-file">
                    <span id="upload-file-name">Choose .xlsx file...</span>
                    <input type="file" id="upload-data-file" accept=".xlsx" required>
                </label>
                <p id="upload-status" class="status"></p>
            </div>
            
          </div>
          <div class="card">
            <h3 class="card-title">Recent Check-Ins</h3>
            <ul id="checkin-list" class="checkin-list" style="max-height: 400px; overflow-y: auto;">
              <li class="checkin-item">No check-ins yet.</li>
            </ul>
          </div>
        </div>
      </section>

      <section id="form-analysis" class="tab-content">
        <div class="content">
          <div class="card">
            <h3 class="card-title">Analyze Your Form</h3>
            <form id="form-analysis-form">
              <div class="form-group">
                <label class="form-label" for="exercise-select">Exercise</label>
                <select id="exercise-select" class="form-select" required>
                  <option value="">Loading exercises...</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label" for="video-upload">Upload Video</label>
                <label class="file-input-wrapper" for="video-upload-real">
                    <span id="file-name-display">Choose a video file...</span>
                    <input type="file" id="video-upload-real" accept="video/mp4,video/mov,video/avi" required>
                </label>
              </div>
              <button type.submit" class="btn" id="analyze-form-btn">Analyze Form</button>
            </form>
          </div>
          <div class="card">
            <h3 class="card-title">Form Analysis Report</h3>
            
            <div id="analysis-progress-container" class="hidden" style="margin-bottom: 1.5rem;">
                <div id="analysis-progress-status" style="font-weight: 500; margin-bottom: 0.5rem; color: var(--text-light);">Uploading...</div>
                <div class="progress-bar-outer">
                    <div id="analysis-progress-bar" class="progress-bar-inner" style="width: 0%;"></div>
                </div>
            </div>

            <div id="form-analysis-response" class="plan-output">
              <p>Please select an exercise and upload a video to get your form analysis.</p>
            </div>
          </div>
        </div>
      </section>

      <section id="coach" class="tab-content">
        <div class="content coach-content">   <!-- thêm class coach-content -->
          <div class="card coach-card full-height-card">   <!-- thêm 2 class -->
            <h3 class="card-title">Get Your AI Evaluation</h3>
            <p style="margin: 1rem 0 2rem; color: var(--text-light); font-size: 1.05rem; line-height: 1.7;">
              Click the button to send your saved plan and check-ins to the AI Coach for a progress review.
            </p>
            <button id="evaluate-btn" class="btn" style="min-width: 280px; padding: 1rem 2rem; font-size: 1.1rem;">Evaluate Progress</button>
            
            <div id="eval-response" class="coach-response"></div>   <!-- kết quả sẽ nằm đây -->
          </div>
        </div>
      </section>
    </main>
  </div>

</body>
</html>